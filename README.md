<p align="center">
    <h1 align="center">Серверная часть</h1>
    </p>
    <p align="justify">Данный репозиторий содержит серверную часть проекта, которая обеспечивает работу клиент-приложения.</p>  
  <p align="justify"> Репозиторий клиент-приложения: https://github.com/olegMarin/miac39client</p>
    
<h2>Реализованная функциональность</h2>

</ul>
    <li>Авторизация/Регистрация</li>
	<ul>
		<li>sendSms</li>
		<p align = "justify">
		Пользователь отправляет номер телефона, сервер генерирует пинкод. Происходит поиск в бд пользователя с таким именем. 
		Если он существует, то просто обновляется пинкод, иначе добавляется новый пользователь. Номер пинкода отправляется на телефон с использованием сервиса SMS AERO
		В ответ сервер отправляет существует ли пользователь и номер очереди.
		</p>
		<li>pinCheck</li>
		<p align = "justify">
			Пользователь вводит полученный пинкод, сервер в БД проверяет соответствие, если совпадает, отправляет true и токен пользователя, иначе false.
			Существует тестовый номер для проверки работы программы. Номер: 79517177545 Код: 0000
			</p>
	</ul>
   <li>Получение измерений</li>
   <ul>
		<li>setData</li>
		<p align = "justify">
			Пользователь вводит данные и отправляет их. Параметры добавляются в БД, возвращается done. Если что-то пошло не так возвращаем текст ошибки.
			</p>
	</ul>
    <li>Отправка истории измерений</li>
	   <ul>
	  	  <li>getHistory</li> 
			<p align = "justify">
			При нажатие на кнопку "История" в приложении отправляется запрос(который хранит токен пользователя) на сервер. Сервер ищет пользователя в БД и возвращает все его измерения. Они упаковываются и отправляются обратно.
			</p>
		</ul>
	<li>Распознование измерений по фотографии</li>
		<ul>
	  	  <li>photoAnalize</li>
			Пользователь отправляет фотографию на сервер. Сервер запускает нейросеть, передавая ей адрес фотографии и ограничивающие параметры.
		</ul>
</ul>
<h2>Особенности проекта</h2>
<p align = "justify">
<ul>
</ul>
	 <li>Нейронная сеть, считывающая показания с картинки</li>
	 <ul>
	 <p align = "justify">
		Нейросеть определяет цифры на дисплее тонометра. Для неё создан отдельный шрифт, который используется в тонометрах. Используя этот шрифт, нейросеть распознает цифры, но не со 100% вероятность, но хорошо распознаёт на белом фоне.
		Для того чтобы у картинок был белый фон у картинки сначала повышается яркость, затем контрастность. Тогда цифры становиться хорошо видно. Все темные пиксели закрашиваются белым, остальное чёрным. Далее инвертируются цвета и нейросеть распознаёт их. Однако после обработки цифры не всегда ровные, поэтому нейросеть может ошибаться.
		В будущем этв проблема будет исправлена, так как будет больше исходных данных от пользователей.
	</p>
	</ul>
 </p>
<h2>Основной стек технологий:</h2>
<ul>
    <li>С#</li>
	<li>Python</li>
	<li>MySQL</li>

 </ul>
<h2>Демо</h2>
Демо сервиса можно найти тут: http://miac39client.businessmod.ru/

Нативное приложение находится тут: http://miac39client.businessmod.ru/miac39clienl.apk
<p>Реквизиты тестового пользователя:</p> 
<ul>
<p>Номер телефона: <b>79517177545</b> Код доступа: <b>0000</b></p>
</ul>

<h2>Среда запуска</h2>

1) Развертывание сервиса производится на debian-like linux (debian 9+);
2) Требуется установленный .Net Core;
3) Требуется установленная СУБД Mysql (версия 8+);
4) Требуется установленный python (версия 3.7+);
5) Требуется установленная библиотека pytesseract;
6) Требуется установленная 


<h2>Установка</h4>


<h3>База данных</h3>
<p align = "justify">

~~~
sudo apt-get install mysql-server
sudo systemctl restart mysql
sudo mysql_secure_installation
mysql -u root -p
qort0408
CREATE DATABASE mydb;
quit
~~~
### Выполнение миграций

Для заполнения базы данных системной информацией выполните в корневой папке сервиса: 
~~~
mysql -u root -p -f mydb < generatedb.sql
qort0408
~~~
и согласитесь с запросом
<h2>Настройка</h2> 
После запуска будет сконфигурирован файл settings.txt вида:
~~~
{
  "serverUrl": "",
  "serverIP": "",
  "login": "",
  "nameBD": "",
  "password": ""
}
~~~
В файле необходимо заполнить поля соответствубщими данными. После этого перезапустить сервер.
### Внутренние команды
В сервере реализованы внутренние команды для упрощённого управления.
1) "debug on" : включает режим вывода логов напрямую в консоль
2) "debug off" : выключает режим вывода логов напрямую в консоль 
3) "shutdown" : безопасно выключает сервер
4) "editprop" : изменение параметров сервера в файле settings.txt напрямую в консоли. После каждого изменения автоматически производится перезапуск
 





